<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Administrador Gym</title>
<style>
body { font-family:'Segoe UI', sans-serif; margin:0; background:#111; color:#fff; }
header { background: url('https://images.unsplash.com/photo-1517836357463-d25dfeac3438') no-repeat center center/cover; height: 100vh; position:relative; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
header::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:0; }
.container { position:relative; z-index:1; background:rgba(0,0,0,0.7); padding:40px; border-radius:15px; max-width:500px; width:90%; text-align:center; }
nav { display:flex; justify-content:space-around; margin-bottom:20px; }
nav button { padding:10px 20px; border:none; border-radius:5px; background:#2ecc71; color:#fff; cursor:pointer; transition:0.3s; }
nav button:hover { background:#27ae60; }
section { display:none; margin-top:20px; }
select,input,textarea,button { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none; }
a.button { display:inline-block; padding:10px 20px; background:#25D366; color:#fff; text-decoration:none; border-radius:5px; }
textarea { resize: none; height: 100px; }
</style>
</head>
<body>

<header>
<div class="container">
<h1>Panel Administrador Gym</h1>

<!-- Navegación -->
<nav>
<button onclick="showSection('alerta')">Alerta Membresía</button>
</nav>

<!-- Sección alerta -->
<section id="alerta">
  <h2>🔔 Enviar alerta de membresía</h2>
  
  <!-- Dropdown de usuarios -->
  <select id="contactos"><option value="">Selecciona un usuario</option></select>
  
  <!-- Botón enviar WhatsApp -->
  <a id="btnAlerta" class="button" href="#" target="_blank">🚀 Enviar Alerta por WhatsApp</a>
</section>

</div>
</header>

<script>
// Mostrar la sección activa
function showSection(id) {
  document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// Array global de usuarios
let usuariosData = [];

// Cargar usuarios desde Web App
function cargarUsuarios(data) {
  const select = document.getElementById("contactos");
  select.innerHTML = '<option value="">Selecciona un usuario</option>';

  usuariosData = data.map(u => {
    let fechaVenc = null;
    if(u["Fecha de Pago"]) {
      const fechaPago = new Date(u["Fecha de Pago"]);
      fechaVenc = new Date(fechaPago);
      fechaVenc.setMonth(fechaVenc.getMonth() + 1); // sumar 1 mes
    }
    return {
      "NombreCompleto": u["Nombre Completo"],
      "NumeroContacto": u["Numero de Contacto"],
      "FechaVencimiento": fechaVenc
    };
  });

  // Llenar el dropdown
  usuariosData.forEach(u => {
    const option = document.createElement("option");
    option.value = u["NumeroContacto"];
    option.textContent = u["NombreCompleto"];
    select.appendChild(option);
  });
}

// Cargar usuarios con JSONP
var script = document.createElement('script');
script.src = "https://script.google.com/macros/s/AKfycbxny5x1P_HUdiB1kLrJ_rxhSxyPlQKxadfhzCBjAPCqVS-67pPFx29gMPBeHhrT1QE/exec?callback=cargarUsuarios";
document.body.appendChild(script);

// BOTÓN enviar WhatsApp
document.getElementById("btnAlerta").addEventListener("click", function(e){
  e.preventDefault(); // evita recarga de página

  const select = document.getElementById("contactos");
  let numero = select.value;

  if(!numero) {
    alert("Selecciona un usuario");
    return;
  }

  numero = numero.replace(/\D/g,''); // limpiar solo dígitos

  const usuario = usuariosData.find(u => u["NumeroContacto"].replace(/\D/g,'') === numero);
  if(!usuario) return;

  // Generar mensaje automático
  let mensaje = "";
  const hoy = new Date();
  const diffDias = Math.ceil((usuario.FechaVencimiento - hoy) / (1000*60*60*24));

  if(diffDias < 0) {
    mensaje = `Hola ${usuario.NombreCompleto}, tu membresía ya venció. Por favor renueva cuanto antes.`;
  } else if(diffDias <= 3) {
    mensaje = `Hola ${usuario.NombreCompleto}, tu membresía vence en ${diffDias} día(s). ¡No te quedes sin acceso!`;
  } else {
    const opciones = { year: 'numeric', month: '2-digit', day: '2-digit' };
    const fechaStr = usuario.FechaVencimiento.toLocaleDateString('es-CO', opciones);
    mensaje = `Hola ${usuario.NombreCompleto}, tu membresía sigue activa hasta el ${fechaStr}.`;
  }

  // Abrir WhatsApp en nueva pestaña
btn.href = `https://api.whatsapp.com/send?phone=57${numero}&text=${decodeURIComponent(mensaje)}`;

});
</script>


</body>
</html>
