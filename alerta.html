<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Administrador Gym</title>
<style>
body { font-family:'Segoe UI', sans-serif; margin:0; background:#111; color:#fff; }
header { background: url('https://images.unsplash.com/photo-1517836357463-d25dfeac3438') no-repeat center center/cover; height: 100vh; position:relative; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
header::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:0; }
.container { position:relative; z-index:1; background:rgba(0,0,0,0.7); padding:40px; border-radius:15px; max-width:500px; width:90%; text-align:center; }
nav { display:flex; justify-content:space-around; margin-bottom:20px; }
nav button { padding:10px 20px; border:none; border-radius:5px; background:#2ecc71; color:#fff; cursor:pointer; transition:0.3s; }
nav button:hover { background:#27ae60; }
section { display:none; margin-top:20px; }
select,input,textarea,button { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none; }
a.button { display:inline-block; padding:10px 20px; background:#25D366; color:#fff; text-decoration:none; border-radius:5px; }
</style>
</head>
<body>

<header>
<div class="container">
<h1>Panel Administrador Gym</h1>
<nav>
<button onclick="showSection('alerta')">Alerta Membres√≠a</button>
<button onclick="showSection('proximos')">Usuarios Pr√≥ximos a Vencer</button>
<button onclick="showSection('registro')">Registrar Pago</button>
</nav>

<!-- Secci√≥n alerta -->
<section id="alerta">
<h2>üîî Enviar alerta de membres√≠a</h2>
<select id="contactos"><option value="">Selecciona un usuario</option></select>
<a id="btnAlerta" class="button" href="#" target="_blank">üöÄ Enviar Alerta por WhatsApp</a>
</section>

<!-- Secci√≥n pr√≥ximos a vencer -->
<section id="proximos">
<h2>‚è∞ Usuarios pr√≥ximos a vencer</h2>
<ul id="usuariosProximos"></ul>
</section>

<!-- Secci√≥n registrar pago -->
<section id="registro">
<h2>Registrar nuevo pago</h2>
<form id="formPago">
<input type="date" id="fechaPago" required />
<select id="usuariosPago" required>
<option value="">Selecciona Usuario</option>
</select>
<input type="number" id="montoPago" placeholder="Monto" required />
<select id="medioPago" required>
<option value="">Selecciona Medio de Pago</option>
<option value="Efectivo">Efectivo</option>
<option value="Transferencia">Transferencia</option>
<option value="Tarjeta">Tarjeta</option>
</select>
<button type="submit">Registrar Pago</button>
</form>
</section>

</div>
</header>

<script>
/* Mostrar secci√≥n activa */
function showSection(id) {
  document.querySelectorAll('section').forEach(sec => sec.style.display='none');
  document.getElementById(id).style.display='block';
}

/* Cargar usuarios desde Web App */
function cargarUsuarios(data) {
  const select = document.getElementById("contactos");
  const selectPago = document.getElementById("usuariosPago");
  const proximos = document.getElementById("usuariosProximos");

  const hoy = new Date();
  const dosDias = new Date();
  dosDias.setDate(hoy.getDate() + 2);

  data.forEach(u => {
    const nombre = u["Nombre Completo"];
    const numero = u["Numero de Contacto"];
    const mensaje = u["Mensaje"];
    const fechaVenc = u["FechaVencimiento"]; // opcional, si existe

    // Dropdown alerta
    const option = document.createElement("option");
    option.value = numero + "|" + encodeURIComponent(mensaje);
    option.textContent = nombre;
    select.appendChild(option);

    // Dropdown pago
    const optionPago = document.createElement("option");
    optionPago.value = nombre;
    optionPago.textContent = nombre;
    selectPago.appendChild(optionPago);

    // Pr√≥ximos a vencer
    if(fechaVenc && new Date(fechaVenc) <= dosDias) {
      const li = document.createElement("li");
      li.textContent = `${nombre} - Vence: ${fechaVenc}`;
      proximos.appendChild(li);
    }
  });
}

/* JSONP para cargar usuarios */
var script = document.createElement('script');
script.src = "https://script.google.com/macros/s/AKfycbztRoPPZ6wSE7UUV87Tb8eObUr8gWbVk4CCatr13zuVnqV6x_Ab4OcEeuwg3XndufQ/exec?callback=cargarUsuarios";
document.body.appendChild(script);

/* Enviar WhatsApp */
document.getElementById("contactos").addEventListener("change", function() {
  const val = this.value;
  if(!val) return;
  const [numero,mensaje] = val.split("|");
  const btn = document.getElementById("btnAlerta");
  btn.href = `https://api.whatsapp.com/send?phone=57${numero}&text=${decodeURIComponent(mensaje)}`;
});

/* Registrar Pago */
document.getElementById("formPago").addEventListener("submit", function(e) {
  e.preventDefault();

  const fecha = document.getElementById("fechaPago").value;
  const nombre = document.getElementById("usuariosPago").value;
  const monto = document.getElementById("montoPago").value;
  const medio = document.getElementById("medioPago").value;

  const url = "https://script.google.com/macros/s/AKfycbwNbYVD5FGUYMS7lDB-9Ij3jkShlExnvcq28K4ZGxlD9hnp7zhrfz7q64waZGHOwbg/exec";

  fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      fechaPago: fecha,
      nombre: nombre,
      monto: monto,
      medioPago: medio
    })
  })
  .then(res => res.json())
  .then(res => {
    if(res.status === "ok") alert("Pago registrado correctamente");
    else alert("Error al registrar pago: " + (res.message || ""));
    document.getElementById("formPago").reset();
  })
  .catch(err => {
    console.error(err);
    alert("Error al registrar pago: " + err);
  });
});
</script>

</body>
</html>
